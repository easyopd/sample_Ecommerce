import{a as r,j as e,q as F,_ as q,u as z,h as A,i as M,Q as o}from"./react-vendor-BNWg92C-.js";import{m as $,d as B,f as O}from"./index-DGHVRrrZ.js";import{L as U}from"./Layout-DvsYrKGp.js";import{h as L,c as J,f as Q,u as H}from"./firebase-vendor-C4yHmXkd.js";import{S as E}from"./vendor-DpNfi1_7.js";function K({name:f,address:n,pincode:g,phoneNumber:h,setName:b,setAddress:s,setPincode:j,setPhoneNumber:v,buyNow:w}){let[P,p]=r.useState(!1);function m(){p(!1)}function N(){p(!0)}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"  text-center rounded-lg text-white font-bold",children:e.jsx("button",{type:"button",onClick:N,className:"w-full py-2 text-center rounded-lg text-white font-bold ",style:{backgroundColor:"#22333B"},children:"Buy Now"})}),e.jsx(F,{appear:!0,show:P,as:r.Fragment,children:e.jsxs(q,{as:"div",className:"relative z-10",onClose:m,children:[e.jsx(F.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(F.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx(q.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl p-2  text-left align-middle shadow-xl transition-all bg-gray-50",children:e.jsx("section",{className:"",children:e.jsx("div",{className:"flex flex-col items-center justify-center py-8 mx-auto  lg:py-0",children:e.jsx("div",{className:"w-full  rounded-lg md:mt-0 sm:max-w-md xl:p-0 ",children:e.jsxs("div",{className:"p-6 space-y-4 md:space-y-6 sm:p-8",children:[e.jsxs("form",{className:"space-y-4 md:space-y-6",action:"#",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block mb-2 text-sm font-medium text-gray-900",children:"Enter Full Name"}),e.jsx("input",{value:f,onChange:a=>b(a.target.value),type:"name",name:"name",id:"name",className:" border outline-0 border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 bg-gray-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block mb-2 text-sm font-medium text-gray-900",children:"Enter Full Address"}),e.jsx("input",{value:n,onChange:a=>s(a.target.value),type:"text",name:"address",id:"address",className:" border outline-0 border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 bg-gray-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block mb-2 text-sm font-medium text-gray-900",children:"Enter Pincode"}),e.jsx("input",{value:g,onChange:a=>j(a.target.value),type:"text",name:"pincode",id:"pincode",className:" border outline-0 border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 bg-gray-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobileNumber",className:"block mb-2 text-sm font-medium text-gray-900",children:"Enter Mobile Number"}),e.jsx("input",{value:h,onChange:a=>v(a.target.value),type:"text",name:"mobileNumber",id:"mobileNumber",className:" border outline-0 border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 bg-gray-100",required:!0})]})]}),e.jsx("button",{onClick:()=>{w(),m()},type:"button",className:"focus:outline-none w-full text-white  hover:bg-violet-800  outline-0 font-medium rounded-lg text-sm px-5 py-2.5 ",style:{backgroundColor:"#22333B"},children:"Order Now"})]})})})})})})})})]})})]})}function ee(){const f=r.useContext($),{mode:n}=f,g=z(),h=localStorage.getItem("user"),b=A(),s=M(t=>t.cart),j=t=>{b(B(t)),o.success("Deleted from cart")};r.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(s))},[s]);const[v,w]=r.useState(0);r.useEffect(()=>{let t=0;s.forEach(d=>{t+=parseInt(d.price)}),w(t)},[s]);const p=0+v,[m,N]=r.useState(""),[a,I]=r.useState(""),[k,_]=r.useState(""),[S,D]=r.useState(""),R=async()=>{if(h){if(!m||!a||!k||!S)return o.error("All fields are required");const t={name:m,address:a,pincode:k,phoneNumber:S,date:new Date().toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric"})};if(s.some(l=>l.quantity<=0))return o.error("Some products are out of stock. Please update your cart.");try{const l=await E.post("https://us-central1-hunarshawls-7f05d.cloudfunctions.net/createOrder",{amount:p}),{id:i,amount:u,currency:x}=l.data,y={key:"rzp_live_m1KjRaIiXqwMu5",amount:u,currency:x,order_id:i,name:"Hunar-Pashmina",description:"Order Payment",handler:async function(C){try{await T(i,C.razorpay_payment_id,t)}catch{o.error("Payment verification failed.")}},theme:{color:"#3399cc"}};new window.Razorpay(y).open()}catch{o.error("Failed to create order. Please try again.")}}else o.error("Please login first"),g("/login")},T=async(t,d,l)=>{try{const i=JSON.parse(localStorage.getItem("user")),u=(i==null?void 0:i.email)||"no-email@provided.com",x=s.map(c=>({title:c.title,price:c.price,quantity:c.quantity,productId:c.id,imageUrl:c.imageUrl1}));if((await E.post("https://us-central1-hunarshawls-7f05d.cloudfunctions.net/verifyPayment",{order_id:t,payment_id:d,email:u,addressInfo:l,orderDetails:x})).data.success){o.success("Payment verified successfully! Email Sent."),await L(J(O,"orders"),{orderId:t,paymentId:d,email:u,addressInfo:l,orderDetails:x,status:"Paid",date:new Date().toISOString()});for(let c of s){const C=Q(O,"products",c.id);await H(C,{quantity:c.quantity-1})}o.success("Order placed successfully!")}else o.error("Payment verification failed!")}catch{o.error("Error verifying payment. Please contact support.")}};return e.jsx(U,{children:e.jsxs("div",{className:`min-h-screen pt-5 pb-20 transition-colors duration-300 ${n==="dark"?"bg-gray-900 text-white":"bg-aqua text-black"}`,children:[e.jsx("h1",{className:"mb-10 text-center text-2xl font-bold",children:"Cart Items"}),e.jsxs("div",{className:"mx-auto max-w-5xl justify-center px-6 md:flex md:space-x-6 xl:px-0",children:[e.jsx("div",{className:"rounded-lg md:w-2/3",children:s.map((t,d)=>{const{title:l,price:i,description:u,imageUrl1:x,quantity:y}=t;return e.jsxs("div",{className:"justify-between mb-6 rounded-lg border drop-shadow-xl bg-white p-6 sm:flex sm:justify-start",style:{backgroundColor:n==="dark"?"rgb(32 33 34)":"",color:n==="dark"?"white":""},children:[e.jsx("img",{src:x,alt:"product-image",className:"w-full rounded-lg sm:w-40 transition-transform duration-1000 ease-in-out hover:scale-110"}),e.jsxs("div",{className:"sm:ml-4 sm:flex sm:w-full sm:justify-between",children:[e.jsxs("div",{className:"mt-5 sm:mt-0",children:[e.jsx("h2",{className:`text-lg font-bold transition-colors duration-300 ${n==="dark"?"text-white":"text-gray-900"}`,children:l}),e.jsx("h2",{className:`text-sm transition-colors duration-300 ${n==="dark"?"text-gray-300":"text-gray-900"}`,children:u}),e.jsxs("p",{className:`mt-1 text-xs font-semibold transition-colors duration-300 ${n==="dark"?"text-gray-400":"text-gray-700"}`,children:["₹",i," | Quantity: ",y>0?y:"Out of Stock"]})]}),e.jsx("div",{onClick:()=>j(t),className:"mt-4 flex justify-between sm:space-y-6 sm:mt-0 sm:block sm:space-x-6",children:e.jsx("button",{className:"bg-red-500 text-white px-2 py-1 rounded transition-transform duration-1000 ease-in-out hover:scale-110",children:"Remove"})})]})]},d)})}),e.jsxs("div",{className:`mt-6 h-full rounded-lg border p-6 shadow-md md:mt-0 md:w-1/3 
                transition-transform duration-1000 ease-in-out hover:scale-110 
                sticky bottom-5 
                ${n==="dark"?"bg-gray-900 text-white":"bg-white text-black"}`,children:[e.jsxs("p",{className:"text-lg font-bold",children:["Total: ₹",p]}),e.jsx(K,{name:m,address:a,pincode:k,phoneNumber:S,setName:N,setAddress:I,setPincode:_,setPhoneNumber:D,buyNow:R})]})]})]})})}export{ee as default};
